<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Central de Notícias</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        #sidebar { transition: transform 0.3s ease-in-out; }
        #overlay { transition: opacity 0.3s ease-in-out; }
        #back-to-top-btn { transition: opacity 0.3s, transform 0.3s; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Menu Lateral (Sidebar) -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden opacity-0"></div>
    <aside id="sidebar" class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg z-30 transform -translate-x-full">
        <div class="p-4 flex justify-between items-center border-b">
            <h2 class="font-bold text-lg text-pink-600">Categorias</h2>
            <button id="close-sidebar-btn" class="text-gray-600 hover:text-gray-900">&times;</button>
        </div>
        <nav id="category-nav" class="p-4"></nav>
    </aside>

    <!-- Cabeçalho do site -->
    <header class="bg-white shadow-md sticky top-0 z-10">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <button id="open-sidebar-btn" class="p-2 text-gray-600 hover:text-pink-600">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                </button>
                <div class="text-center">
                    <h1 class="text-3xl font-bold text-pink-600">Central de Notícias</h1>
                    <p class="text-gray-500 mt-1 text-sm md:text-base">As últimas notícias do mundo das celebridades!</p>
                </div>
                <div class="w-8"></div>
            </div>
            <div id="search-bar-container" class="mt-4">
                <input type="text" id="search-input" placeholder="Pesquisar notícias..." class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-400 focus:border-transparent">
            </div>
        </div>
    </header>

    <!-- Página Principal (Lista de Notícias) -->
    <main id="main-page" class="hidden container mx-auto px-4 py-8">
        <div id="loading" class="text-center py-10">
            <p class="text-lg font-semibold">A organizar as fofocas mais recentes...</p>
        </div>
        <div id="news-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        <!-- Container para o botão "Carregar Mais" -->
        <div id="load-more-container" class="text-center mt-8"></div>
    </main>

    <!-- Página de Detalhes da Notícia (escondida por defeito) -->
    <main id="details-page" class="hidden container mx-auto px-4 py-8"></main>

    <!-- Botão Voltar ao Topo -->
    <button id="back-to-top-btn" class="fixed bottom-5 right-5 bg-pink-600 text-white p-3 rounded-full shadow-lg opacity-0 transform translate-y-4 hover:bg-pink-700">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>
    </button>

    <!-- Rodapé -->
    <footer class="text-center py-4 text-gray-500 text-sm">
        <p>&copy; 2024 Central de Notícias. Todos os direitos reservados.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const googleSheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vShVSJjWn39t_3R1RXw-qcAldFT5bvK0GhTu53KNs-6w5oi-YAgXhq5kwoyaphXaZUzpQsnOwFw_pFb/pub?gid=1365485367&single=true&output=csv';

            const mainPage = document.getElementById('main-page');
            const detailsPage = document.getElementById('details-page');
            const newsContainer = document.getElementById('news-container');
            const loadingIndicator = document.getElementById('loading');
            const openSidebarBtn = document.getElementById('open-sidebar-btn');
            const closeSidebarBtn = document.getElementById('close-sidebar-btn');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            const categoryNav = document.getElementById('category-nav');
            const searchInput = document.getElementById('search-input');
            const backToTopBtn = document.getElementById('back-to-top-btn');
            const searchBarContainer = document.getElementById('search-bar-container');
            const loadMoreContainer = document.getElementById('load-more-container');

            let allNewsItems = [];
            let currentFilteredNews = [];
            let displayedNewsCount = 0;
            const NEWS_PER_PAGE = 12;
            let currentCategoryFilter = null;

            function handleRouting() {
                const hash = window.location.hash;
                if (hash.startsWith('#noticia/')) {
                    const newsId = hash.substring(9);
                    const newsItem = allNewsItems.find(item => item.id === newsId);
                    if (newsItem) {
                        renderDetailsPage(newsItem);
                        mainPage.classList.add('hidden');
                        detailsPage.classList.remove('hidden');
                        searchBarContainer.classList.add('hidden');
                        window.scrollTo(0, 0);
                    } else {
                        window.location.hash = '';
                    }
                } else {
                    mainPage.classList.remove('hidden');
                    detailsPage.classList.add('hidden');
                    searchBarContainer.classList.remove('hidden');
                    applyFiltersAndRender();
                }
            }

            window.addEventListener('hashchange', handleRouting);

            function openSidebar() { sidebar.classList.remove('-translate-x-full'); overlay.classList.remove('hidden', 'opacity-0'); }
            function closeSidebar() { sidebar.classList.add('-translate-x-full'); overlay.classList.add('opacity-0'); setTimeout(() => overlay.classList.add('hidden'), 300); }
            openSidebarBtn.addEventListener('click', openSidebar);
            closeSidebarBtn.addEventListener('click', closeSidebar);
            overlay.addEventListener('click', closeSidebar);

            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) { backToTopBtn.classList.remove('opacity-0', 'translate-y-4'); } 
                else { backToTopBtn.classList.add('opacity-0', 'translate-y-4'); }
            });
            backToTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

            function displayError(message) { loadingIndicator.classList.add('hidden'); newsContainer.innerHTML = `<p class="text-center text-red-500 col-span-full">${message}</p>`; loadMoreContainer.innerHTML = ''; }
            function parseDate(dateStr) { if (!dateStr) return null; const isoDateStr = dateStr.replace(' ', 'T'); const date = new Date(isoDateStr); return !isNaN(date.getTime()) ? date : null; }
            function getLocalDayKey(date) { const year = date.getFullYear(); const month = (date.getMonth() + 1).toString().padStart(2, '0'); const day = date.getDate().toString().padStart(2, '0'); return `${year}-${month}-${day}`; }
            function createNewsId(title, date) { return `${date.getTime()}-${title.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '').slice(0, 50)}`; }

            function renderDetailsPage(item) {
                const pageUrl = window.location.href.split('#')[0] + '#noticia/' + item.id;
                const encodedUrl = encodeURIComponent(pageUrl);
                const encodedTitle = encodeURIComponent(item.titulo);
                
                // Lógica para encontrar notícias relacionadas
                const relatedNews = allNewsItems
                    .filter(relatedItem => relatedItem.categoria === item.categoria && relatedItem.id !== item.id)
                    .slice(0, 4); // Pega até 4 notícias relacionadas

                let relatedNewsHtml = '';
                if (relatedNews.length > 0) {
                    relatedNewsHtml = `
                        <div class="mt-12">
                            <h3 class="text-2xl font-bold mb-4 border-b-2 border-pink-200 pb-2">Notícias Relacionadas</h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                                ${relatedNews.map(relatedItem => `
                                    <a href="#noticia/${relatedItem.id}" class="block bg-white rounded-lg shadow-md overflow-hidden transform hover:scale-105 transition-transform duration-300">
                                        <img src="${relatedItem.imagem}" alt="${relatedItem.titulo}" class="w-full h-32 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x300/fce7f3/c026d3?text=Imagem';">
                                        <div class="p-4">
                                            <h4 class="font-bold text-sm">${relatedItem.titulo}</h4>
                                        </div>
                                    </a>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }

                detailsPage.innerHTML = `
                    <div class="bg-white rounded-lg shadow-lg p-4 md:p-8">
                        <button onclick="window.location.hash=''" class="mb-6 inline-flex items-center text-pink-600 hover:text-pink-800">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                            Voltar para a lista
                        </button>
                        <h1 class="text-3xl md:text-4xl font-bold mb-4">${item.titulo}</h1>
                        <div class="flex items-center text-sm text-gray-500 mb-4">
                            <span class="mr-4">${new Date(item.date).toLocaleDateString('pt-BR', { year: 'numeric', month: 'long', day: 'numeric', timeZone: 'America/Sao_Paulo' })}</span>
                            <span>Fonte: ${item.fonte}</span>
                        </div>
                        <img src="${item.imagem}" alt="Imagem da notícia: ${item.titulo}" class="w-full h-auto max-h-96 object-cover rounded-lg mb-6" onerror="this.onerror=null;this.src='https://placehold.co/1200x600/fce7f3/c026d3?text=Imagem+Indisponível';">
                        <div class="prose max-w-none text-gray-700 text-lg">
                            <p>${item.resumo}</p>
                        </div>
                        <div class="mt-8 pt-6 border-t flex flex-col sm:flex-row justify-between items-center gap-4">
                            <a href="${item.link}" target="_blank" rel="noopener noreferrer" class="inline-block bg-pink-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-pink-700 transition-colors">
                                Ler notícia original
                            </a>
                            <div class="flex items-center space-x-4">
                                <span class="text-sm text-gray-600">Partilhar:</span>
                                <a href="https://api.whatsapp.com/send?text=${encodedTitle}%20${encodedUrl}" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-green-500"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.886-.001 2.267.651 4.383 1.808 6.166l-1.225 4.462 4.574-1.194z"/></svg></a>
                                <a href="https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-blue-600"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v2.385z"/></svg></a>
                                <a href="https://twitter.com/intent/tweet?url=${encodedUrl}&text=${encodedTitle}" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-black"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24h-6.617l-5.21-6.817-6.044 6.817h-3.308l7.73-8.835-7.995-10.66h6.838l4.774 6.405 5.727-6.405z"/></svg></a>
                            </div>
                        </div>
                        ${relatedNewsHtml}
                    </div>
                `;
            }

            function renderNewsList(append = false) {
                if (!append) {
                    newsContainer.innerHTML = '';
                    loadMoreContainer.innerHTML = '';
                }

                const newsToRender = currentFilteredNews.slice(0, displayedNewsCount);
                if (newsToRender.length === 0) { displayError("Nenhuma notícia encontrada com os filtros atuais."); return; }

                const groupedByDay = newsToRender.reduce((acc, item) => {
                    const dayKey = getLocalDayKey(item.date);
                    if (!acc[dayKey]) acc[dayKey] = [];
                    acc[dayKey].push(item);
                    return acc;
                }, {});

                newsContainer.innerHTML = ''; 
                const sortedDays = Object.keys(groupedByDay).sort().reverse();

                sortedDays.forEach(dayKey => {
                    const newsForDay = groupedByDay[dayKey];
                    const dateParts = dayKey.split('-');
                    const dateForTitle = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);
                    
                    if (!document.getElementById(`header-${dayKey}`)) {
                        const dateHeader = document.createElement('h2');
                        dateHeader.id = `header-${dayKey}`;
                        dateHeader.className = 'text-2xl font-bold text-gray-700 col-span-full mt-8 mb-4 border-b-2 border-pink-200 pb-2';
                        dateHeader.textContent = dateForTitle.toLocaleDateString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', timeZone: 'UTC' });
                        newsContainer.appendChild(dateHeader);
                    }

                    newsForDay.forEach(item => {
                        if (document.getElementById(`card-${item.id}`)) return; // Evita duplicar cards
                        const card = document.createElement('div');
                        card.id = `card-${item.id}`;
                        card.className = 'bg-white rounded-lg shadow-lg overflow-hidden flex flex-col transform hover:scale-105 transition-transform duration-300';
                        card.innerHTML = `
                            <a href="#noticia/${item.id}" class="block h-full flex flex-col">
                                <img src="${item.imagem}" alt="Imagem da notícia: ${item.titulo}" class="w-full h-48 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/fce7f3/c026d3?text=Imagem+Indisponível';">
                                <div class="p-6 flex flex-col flex-grow">
                                    <span class="inline-block bg-pink-100 text-pink-700 text-xs font-semibold px-2 py-1 rounded-full mb-2 self-start">${item.categoria || 'Geral'}</span>
                                    <h2 class="text-xl font-bold mb-2">${item.titulo}</h2>
                                    <p class="text-gray-600 text-sm mb-4 flex-grow">${item.resumo.slice(0, 100)}...</p>
                                    <p class="text-xs text-gray-400 mt-auto">Fonte: ${item.fonte}</p>
                                </div>
                            </a>
                        `;
                        newsContainer.appendChild(card);
                    });
                });

                loadMoreContainer.innerHTML = '';
                if (displayedNewsCount < currentFilteredNews.length) {
                    const loadMoreBtn = document.createElement('button');
                    loadMoreBtn.className = 'bg-pink-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-pink-700 transition-colors';
                    loadMoreBtn.textContent = 'Carregar Mais Notícias';
                    loadMoreBtn.addEventListener('click', () => {
                        displayedNewsCount += NEWS_PER_PAGE;
                        renderNewsList(true);
                    });
                    loadMoreContainer.appendChild(loadMoreBtn);
                }
            }
            
            function applyFiltersAndRender() {
                const searchTerm = searchInput.value.toLowerCase();
                let filteredNews = allNewsItems;

                if (currentCategoryFilter) {
                    filteredNews = filteredNews.filter(item => item.categoria === currentCategoryFilter);
                }
                if (searchTerm) {
                    filteredNews = filteredNews.filter(item => 
                        item.titulo.toLowerCase().includes(searchTerm) || 
                        item.resumo.toLowerCase().includes(searchTerm)
                    );
                }
                
                currentFilteredNews = filteredNews;
                displayedNewsCount = NEWS_PER_PAGE;
                renderNewsList();
            }

            searchInput.addEventListener('input', applyFiltersAndRender);
            categoryNav.addEventListener('click', (e) => {
                e.preventDefault();
                if (e.target.classList.contains('category-link')) {
                    const category = e.target.dataset.category;
                    currentCategoryFilter = (category === 'all' ? null : category);
                    window.location.hash = '';
                    applyFiltersAndRender();
                    closeSidebar();
                }
            });

            Papa.parse(googleSheetURL, {
                download: true, header: false, skipEmptyLines: true,
                complete: (results) => {
                    if (results.errors.length) { displayError("Ocorreu um erro ao ler o formato da planilha."); return; }
                    const dataRows = results.data;
                    if (!dataRows || dataRows.length < 2) { displayError("Nenhuma notícia encontrada na planilha."); return; }

                    allNewsItems = dataRows.slice(1).map(row => {
                        const dateObj = parseDate(row[0]);
                        if (!dateObj) return null;
                        const title = row[2];
                        return { 
                            id: createNewsId(title, dateObj), date: dateObj, fonte: row[1], titulo: title, 
                            resumo: row[3], link: row[4], imagem: row[5], categoria: row[6] 
                        };
                    }).filter(item => item && item.titulo).sort((a, b) => b.date - a.date);

                    const categories = [...new Set(allNewsItems.map(item => item.categoria).filter(Boolean))];
                    categoryNav.innerHTML = `<a href="#" class="block py-2 px-4 rounded hover:bg-pink-100 category-link" data-category="all">Exibir Todas</a>`;
                    categories.sort().forEach(cat => { categoryNav.innerHTML += `<a href="#" class="block py-2 px-4 rounded hover:bg-pink-100 category-link" data-category="${cat}">${cat}</a>`; });
                    
                    mainPage.classList.remove('hidden');
                    loadingIndicator.classList.add('hidden');
                    handleRouting();
                },
                error: (err) => { displayError("Não foi possível conectar à planilha."); }
            });
        });
    </script>
</body>
</html>
